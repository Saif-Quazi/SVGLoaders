<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Loaders API - Playground</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        <svg class="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
    </button>

    <div class="container">
        <header>
            <h1>SVG Loaders API</h1>
            <p class="subtitle">Customize your animated SVG loader with real-time preview</p>
        </header>

        <div class="playground">
            <div class="speed-selector-floating">
                <div class="speed-pill">
                    <div class="speed-indicator" id="speedIndicator"></div>
                    <button class="speed-option" data-value="slow">Slow</button>
                    <button class="speed-option active" data-value="normal">Normal</button>
                    <button class="speed-option" data-value="fast">Fast</button>
                </div>
            </div>

            <div class="preview-section">
                <div class="preview-container">
                    <img src="/100" alt="SVG Loader Preview" class="loader-image" id="loaderPreview">
                    <div class="url-bar" id="urlBar">
                        <span class="url-text" id="urlText">svgloader.netlify.app/100</span>
                        <button class="copy-btn" id="copyBtn" title="Copy URL">
                            <svg class="copy-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="5" y="5" width="9" height="9" rx="1"/>
                                <path d="M2 11V3a1 1 0 0 1 1-1h8"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="size-indicator" id="dimensions">100 x 100</div>
            </div>


            <div class="controls-section">
                <div class="controls-grid">
                    <div class="control-tile">
                        <div class="control-group">
                            <label>
                                <span>Size</span>
                                <span class="control-value" id="sizeValue">100</span>
                            </label>
                            <input type="range" id="size" min="10" max="150" value="100" step="5">
                            <div class="range-labels">
                                <span>10</span>
                                <span>150</span>
                            </div>
                        </div>

                        <div class="control-group">
                            <label>
                                <span>Stroke</span>
                                <span class="control-value" id="strokeValue">4</span>
                            </label>
                            <input type="range" id="stroke" min="1" max="10" value="4" step="1">
                            <div class="range-labels">
                                <span>1</span>
                                <span>10</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-tile">
                        <div class="control-group">
                            <label>Foreground</label>
                            <div class="color-picker">
                                <input type="color" id="fgColor" value="#000000">
                                <input type="text" id="fgHex" value="000000" maxlength="6">
                            </div>
                        </div>

                        <div class="control-group">
                            <label>Background</label>
                            <div class="color-picker">
                                <input type="color" id="bgColor" value="#E5E7EB">
                                <input type="text" id="bgHex" value="E5E7EB" maxlength="6">
                            </div>
                        </div>
                    </div>
                </div>

                <button class="reset-btn" id="resetBtn">Reset to Defaults</button>
            </div>
        </div>
    </div>

    <script>
        const els = {
            size: document.getElementById('size'),
            stroke: document.getElementById('stroke'),
            speedOptions: document.querySelectorAll('.speed-option'),
            speedIndicator: document.getElementById('speedIndicator'),
            fgColor: document.getElementById('fgColor'),
            fgHex: document.getElementById('fgHex'),
            bgColor: document.getElementById('bgColor'),
            bgHex: document.getElementById('bgHex'),
            sizeValue: document.getElementById('sizeValue'),
            strokeValue: document.getElementById('strokeValue'),
            dimensions: document.getElementById('dimensions'),
            preview: document.getElementById('loaderPreview'),
            urlText: document.getElementById('urlText'),
            urlBar: document.getElementById('urlBar'),
            copyBtn: document.getElementById('copyBtn'),
            resetBtn: document.getElementById('resetBtn'),
            themeToggle: document.getElementById('themeToggle')
        };

        const ICONS = {
            sun: '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>',
            moon: '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>',
            copy: '<svg class="copy-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="5" y="5" width="9" height="9" rx="1"/><path d="M2 11V3a1 1 0 0 1 1-1h8"/></svg>',
            copySuccess: '<svg class="copy-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 8 6 11 13 4"/></svg>'
        };

        const defaults = { size: 100, stroke: 4, speed: 'normal', fg: '000000', bg: 'E5E7EB' };
        let currentSpeed = 'normal';
        let debounceTimer;

        function getSystemTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            const icon = els.themeToggle.querySelector('.theme-icon');
            if (theme === 'dark') {
                icon.innerHTML = ICONS.moon;
            } else {
                icon.innerHTML = ICONS.sun;
            }
        }

        function initTheme() {
            const userOverride = localStorage.getItem('themeOverride');
            const systemPreference = getSystemTheme();
            
            if (!userOverride) {
                localStorage.setItem('systemPreference', systemPreference);
            }
            
            const theme = userOverride || systemPreference;
            applyTheme(theme);
        }

        function debounce(func, delay) {
            return function(...args) {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => func.apply(this, args), delay);
            };
        }

        function updatePreview() {
            const size = els.size.value;
            const stroke = els.stroke.value;
            const fg = els.fgHex.value.replace('#', '');
            const bg = els.bgHex.value.replace('#', '');

            els.sizeValue.textContent = size;
            els.strokeValue.textContent = stroke;
            els.dimensions.textContent = `${size} Ã— ${size}`;

            const params = new URLSearchParams();
            if (stroke != defaults.stroke) params.append('stroke', stroke);
            if (fg != defaults.fg) params.append('fg', fg);
            if (bg != defaults.bg) params.append('bg', bg);
            if (currentSpeed != defaults.speed) params.append('speed', currentSpeed);

            const query = params.toString();
            const path = `/${size}${query ? '?' + query : ''}`;
            const displayUrl = `svgloader.netlify.app/${size}${query ? '?' + query : ''}`;
            
            els.urlText.textContent = displayUrl;
            loadImage(path);
        }

        function loadImage(path) {
            els.preview.classList.add('loading');
            const img = new Image();
            img.onload = () => {
                els.preview.src = path;
                setTimeout(() => els.preview.classList.remove('loading'), 100);
            };
            img.onerror = () => {
                els.preview.classList.remove('loading');
            };
            img.src = path;
        }

        const debouncedUpdate = debounce(updatePreview, 1000);

        function syncColorToHex(colorInput, hexInput) {
            hexInput.value = colorInput.value.substring(1).toUpperCase();
            debouncedUpdate();
        }

        function syncHexToColor(hexInput, colorInput) {
            const hex = hexInput.value.replace('#', '').toUpperCase();
            if (/^[0-9A-F]{6}$/i.test(hex)) {
                colorInput.value = '#' + hex;
                debouncedUpdate();
            }
        }

        function setSpeed(speed) {
            currentSpeed = speed;
            
            let activeBtn = null;
            els.speedOptions.forEach((btn) => {
                const isActive = btn.dataset.value === speed;
                btn.classList.toggle('active', isActive);
                if (isActive) activeBtn = btn;
            });
            
            if (activeBtn) {
                const btnRect = activeBtn.getBoundingClientRect();
                const pillRect = activeBtn.parentElement.getBoundingClientRect();
                const leftOffset = btnRect.left - pillRect.left - 4;
                
                els.speedIndicator.style.width = `${btnRect.width}px`;
                els.speedIndicator.style.transform = `translateX(${leftOffset}px)`;
            }
            
            debouncedUpdate();
        }

        els.size.addEventListener('input', () => {
            els.sizeValue.textContent = els.size.value;
            els.dimensions.textContent = `${els.size.value} x ${els.size.value}`;
            debouncedUpdate();
        });
        
        els.stroke.addEventListener('input', () => {
            els.strokeValue.textContent = els.stroke.value;
            debouncedUpdate();
        });

        els.speedOptions.forEach(btn => {
            btn.addEventListener('click', () => setSpeed(btn.dataset.value));
        });
        
        els.fgColor.addEventListener('input', () => syncColorToHex(els.fgColor, els.fgHex));
        els.fgHex.addEventListener('input', () => syncHexToColor(els.fgHex, els.fgColor));
        els.bgColor.addEventListener('input', () => syncColorToHex(els.bgColor, els.bgHex));
        els.bgHex.addEventListener('input', () => syncHexToColor(els.bgHex, els.bgColor));

        els.copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText('https://' + els.urlText.textContent);
                els.copyBtn.innerHTML = ICONS.copySuccess;
                els.copyBtn.classList.add('copied');
                setTimeout(() => {
                    els.copyBtn.innerHTML = ICONS.copy;
                    els.copyBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {}
        });

        els.resetBtn.addEventListener('click', () => {
            els.size.value = defaults.size;
            els.stroke.value = defaults.stroke;
            setSpeed(defaults.speed);
            els.fgHex.value = defaults.fg;
            els.fgColor.value = '#' + defaults.fg;
            els.bgHex.value = defaults.bg;
            els.bgColor.value = '#' + defaults.bg;
            updatePreview();
        });

        els.themeToggle.addEventListener('click', () => {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            localStorage.setItem('themeOverride', newTheme);
        });

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            const userOverride = localStorage.getItem('themeOverride');
            if (!userOverride) {
                const newSystemTheme = e.matches ? 'dark' : 'light';
                localStorage.setItem('systemPreference', newSystemTheme);
                applyTheme(newSystemTheme);
            }
        });

        window.addEventListener('resize', () => {
            setSpeed(currentSpeed);
        });

        initTheme();
        setTimeout(() => setSpeed(currentSpeed), 50);
        updatePreview();
    </script>
</body>
</html>
